<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
	{% include "public/GoogleAnalytics.html" %}
    {% load staticfiles %}
    {% load materials_extras %}
    
        <meta charset="utf-8">
        <title>{{ topic.name }}</title>
        <!-- Internet Explorer meta -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- First Mobile meta -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap -->
        <link href="{% static 'css/bootstrap.css' %}" rel="stylesheet"> 
        <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
        <link href="{% static 'css/style.css' %}" rel="stylesheet">
        <link href="{% static 'css/topic.css' %}" rel="stylesheet">
        <link href="{% static 'fonts/Scheherazade-Regular.ttf' %}" rel="stylesheet">
        <!--[if lt IE 9]>
            <script src="js/html5shiv.min.js"></script>
            <script src="js/respond.min.js"></script>
        <![endif]-->

        <script src="{% static 'js/jquery-3.1.1.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
</head>
<body>
    <!-- start navbar -->
    {% include "public/navbar-user.html" %}
    <!-- end navbar -->
    
	{% if topic %}
        <!-- start page content -->
        <section class="content-section nj-container">
            
            <div class="right-div">
                <div class="arrows-div">
                    <i id="right-arrow" class="fa fa-chevron-right move-arrow" aria-hidden="true"></i>
                    <i id="left-arrow" class="fa fa-chevron-left move-arrow" aria-hidden="true"></i>
                </div>

                <div class="elements-div">
                    {% for doctor in topic.professors.all %}
                        <div class="right-ele doctor-name">
                          <a href="{% url 'display_doctor' doctor.id %}"><p> د.{{ doctor.name }}</p></a>
                        </div>
                    {% endfor %}
                    {% if topic.exams.all|length > 0 %}
                        <div class="right-ele">
                            <div class="right-ele-head">
                                <p>الامتحانات</p>
                            </div>
                            <div class="right-ele-body">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                          <th>السنه</th>
                                          <th>الدكتور</th>
                                          <th>الرابط</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for exam in topic.exams.all %}
                                            <tr>
                                              <td>{{ exam.exam_year }}</td>
                                              {% for professor in exam.professor.all %}
                                                <td>{{ professor.name }}</td>
                                              {% endfor %}
                                              <td><a href="{{ exam.link }}"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    {% endif %}

                    {% if topic.related_content.all|length > 0 %}
                        <div class="right-ele">
                            <div class="right-ele-head">
                                <p>محتوى متعلق</p>
                            </div>
                            <div class="right-ele-body">
                                <table class="table table-hover ">
                                  <thead>
                                    <tr class="materials-table-h">
                                      <th>العنوان</th>
                                      <th>الرابط</th>
                                    </tr>
                                  </thead>
                                  <tbody class="materials-table-b">
                                    <tr>
                                      <td>محمد الدسوقى</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                    <tr>
                                      <td>حازم البكرى</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                    <tr>
                                      <td>شريف بركات</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                    <tr>
                                      <td>شريف بركات</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                    <tr>
                                      <td>شريف بركات</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                  </tbody>
                                </table>
                            </div>
                        </div>
                    {% endif %}

                    {% if topic.related_content.all|length > 0 %}
                        <div class="right-ele">
                            <div class="right-ele-head">
                                <p>ارشيف الماده</p>
                            </div>
                            <div class="right-ele-body">
                                <table class="table table-hover">
                                  <thead>
                                    <tr>
                                      <th>السنه</th>
                                      <th>الترم</th>
                                      <th>الرابط</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr>
                                      <td>2016</td>
                                      <td>الترم الاول</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                    <tr>
                                      <td>2016</td>
                                      <td>الترم الثانى</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                    <tr>
                                      <td>2015</td>
                                      <td>الترم الاول</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                    <tr>
                                      <td>2015</td>
                                      <td>الترم الثانى</td>
                                      <td><a href="#"><i class="fa fa-link" aria-hidden="true"></i></a></td>
                                    </tr>
                                  </tbody>
                                </table>
                            </div>
                        </div>
                    {% endif %}

                </div>

            </div>
            <div class="center-div content-part">
                <div class="Horizontal-adv">
                    <img src="{% static 'pic/adv-xs.jpg' %}">
                </div>
                
                <div class="tabs">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs nav-heads" role="tablist">
                        <li role="presentation" class="active tab">
                            <a href="#content" aria-controls="content" role="tab" data-toggle="tab">المحتوي</a>
                        </li>
                        <li role="presentation" class="tab">
                            <a href="#community" aria-controls="community" role="tab" data-toggle="tab">المجتمع</a>
                        </li>
                        {% if request.user.is_staff %}
                          <li role="presentation" class="tab">
                              <a href="#requests" aria-controls="community" role="tab" data-toggle="tab">الطلبات <span id="requests-number"  class="badge"><!--{{ pending_contributions|length }} {{pending_posts|length }} --></span></a>
                          </li>
                        {% endif %}
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane fade in  active" id="content">
                            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                {% if request.user.is_staff %}
                                    <form id="add-week-form" action="{% url 'api_increment_weeks' %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="topic_id" value="{{ topic.pk }}">
                                        <input id="add-week-btn" type="submit" name="add_week" class="nj-btn" value="أضف أسبوع جديد" />
                                    </form>
                                {% endif %}

                                {% if weeks_days %}
                                  {% for week_title in weeks_days %}
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading{{ forloop.counter }}" data-toggle="collapse" data-parent="#accordion" href="#collapse{{ forloop.counter }}" aria-expanded="true" aria-controls="collapseOne">
                                            <h4 class="panel-title">
                                                {{ week_title }}
                                            </h4>
                                        </div>
                                        <div id="collapse{{ forloop.counter }}" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="headingOne">
                                            <div class="panel-body">
                                                <div class="week-content">
                                                    {% if weeks_materials|week_number:forloop.counter %}
                                                      {% for material in weeks_materials|week_number:forloop.counter %}
                                                        <div class="row content-row">
                                                            <div class="col-xs-2 col-sm-2"><a href="{{ material.link }}"><i class="fa fa-link" aria-hidden="true"></i></a></div>
                                                            <div class="col-sm-5 hidden-xs"><p class="assets-time">{{ material.user.username }} | {{ material.year }}</p></div>
                                                            <div class="col-xs-10 col-sm-5"><p class="resourse-name">{% if material.content_type == 1 %} <i class="fa fa-book" aria-hidden="true"></i> {% elif material.content_type == 2 %} <i class="fa fa-sticky-note" aria-hidden="true"></i> {% else %} <i class="fa fa-tasks" aria-hidden="true"></i> {% endif %}{{ material.name }}</p></div>
                                                        </div>
                                                      {% endfor %}
                                                    {% endif %}
                                                    <div class="assets">
                                                        <p class="assets-h">المشاركات:</p>
                                                        <div class="assets-body">

                                                            {% if sec_materials and sec_materials|week_number:forloop.counter %}
                                                              {% for material in sec_materials|week_number:forloop.counter %}
                                                                <div class="row">
                                                                    <div class="col-xs-10 col-sm-5 assest-name"><p>{{ material.name }}</p></div>
                                                                    {% if material.user.is_staff %}
                                                                        <div class="col-sm-5 hidden-xs"><p class="assets-time">{{ department.team.name }} | {{ material.year }}</p></div>
                                                                    {% else %}
                                                                        <div class="col-sm-5 hidden-xs"><p class="assets-time">{{ material.user.username }} | {{ material.year }}</p></div>
                                                                    {% endif %}
                                                                    <div class="col-xs-2 col-sm-2"><a href="{{ material.link }}" class="assets-link"><i class="fa fa-link" aria-hidden="true"></i></a></div>
                                                                </div>
                                                              {% endfor %}
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                  {% endfor %}
                                {% else %}
                                  <h3>مفيش محتوى للأسف ونجيبة زعلانة</h3>
                                {% endif %}
                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane fade " id="community">
                            <div class="contribute">
                                <div class="btn-div">
                                    <a class="nj-btn" id="contribute-btn" href="#">مشاركة</a>
                                    <a class="nj-btn" id="request-btn" href="#">طلب</a>
                                </div>

                                <div id="contribute-form" class="share-box">
                                    <div class="share-box-inner">
                                        <div class="share-box-head">
                                            <i class="box-close-btn fa fa-times" aria-hidden="true"></i>
                                            <p>إضافة مشاركة</p>
                                        </div>
                                        <div class="share-box-body">
                                            <form action="{% url 'api_add_contribution' %}" method="POST" id="contribution_form">
                                                {% csrf_token %}
                                                <div class="errors-div">
                                                    <div class="alert alert-danger" role="alert">حدث خطا اثناء الارسال ، برجاء المحاوله مره اخرى</div>
                                                </div>
                                                <div class="success-div">
                                                    <div class="alert alert-success" role="alert">تم ارسال المشاركه بنجاح </div>
                                                </div>
                                                <div class="contribution_form-body">
                                                    {% for field in contribution_form %}
                                                        {% if not field.is_hidden %}
                                                            <div class="form-group">
                                                                {{ field.errors }}
                                                                <label class="nj-label">{{ field.label }}</label>
                                                                {{ field }}
                                                            </div>
                                                        {% else %}
                                                            {{ field }}
                                                        {% endif %}
                                                    {% endfor %}
                                                    <input type="submit" name="contribution_submit" value="send" class="nj-btn" id="contribute-btn-send" />
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>


                                <div id="request-form" class="order-box">
                                    <div class="order-box-inner">
                                        <div class="order-box-head">
                                            <i class="box-close-btn fa fa-times" aria-hidden="true"></i>
                                            <p>إضافة طلب</p>
                                        </div>
                                        <div class="order-box-body">
                                            <form action="{% url 'api_add_post' %}" method="POST" id="post_form">
                                                {% csrf_token %}
                                                <div class="errors-div">
                                                    <div class="alert alert-danger" role="alert">حدث خطا اثناء الارسال ، برجاء المحاوله مره اخرى</div>
                                                </div>
                                                <div class="success-div">
                                                    <div class="alert alert-success" role="alert">تم ارسال المشاركه بنجاح </div>
                                                </div>
                                                <div class="post_form-body">
                                                    {% for field in post_request %}
                                                        {% if not field.is_hidden %}
                                                            <div class="form-group">
                                                                {{ field.errors }}
                                                                <label class="nj-label">{{ field.label }}</label>
                                                                {{ field }}
                                                            </div>
                                                        {% else %}
                                                            {{ field }}
                                                        {% endif %}
                                                    {% endfor %}
                                                    <input type="submit" name="request_submit" value="send" class="nj-btn" id="contribute-btn-send" />
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                {% if posts %}
                                    {% for post in posts %}
                                        <div class="post">
                                            <div class="post-body">
                                                <div class="publisher-name"><p>{{ post.user.username }}</p></div>
                                                <div class="post-content">
                                                    <p>{{ post.content }}</p>
                                                    <div class="alert alert-warning no-comments-note" role="alert">لا يوجد تعليقات لهذا المنشور.</div>
                                                    <div class="alert alert-danger error-note" role="alert">حدث حطأ اثناء تحميل التعليقات ، برجاء المحاوله مرة اخرى.</div>
                                                </div>
                                            </div>
                                            <div class="show-hide-comments">
                                                <form action="{% url 'api_get_post_comments' %}" method="get" id="get-comments-form{{ post.id }}">
                                                    <input type="hidden" name="post_id" value="{{ post.id }}" class="post_id_holder">
                                                    <p class="get-comments-btn"><i class="fa fa-comments" aria-hidden="true"></i><span> إظهار التعليقات</span></p>
                                                    <i class="fa fa-spinner fa-spin fa-fw loading"></i>
                                                </form>
                                            </div>
                                            <div class="write-comment">
                                                <form action="{% url 'api_add_comment' %}" method="post" id="add-comment-form{{ post.id }}">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="post_id" value="{{ post.id }}" class="post_id_holder">
                                                    <input type="text" name="comment_content" class="nj-input comment-content" placeholder="اكتب تعليق..." autocomplete="off">
                                                    <i class="fa fa-paper-plane add-comment-btn" aria-hidden="true"></i>
                                                </form>
                                                
                                                
                                            </div>
                                            {% if request.user.is_staff %}
                                                <style>
                                                    .comment .comment-delet{
                                                        display: block;
                                                    }
                                                </style>
                                            {% endif %}
                                            <div class="post-comments">
                                                <!--<div class="comment">
                                                    <form action="api_delete_comment" method="post" id="delete-comment-form">
                                                        <input type="hidden" name="comment_id" value="comment.id" class="comment_id_holder">
                                                        <p class="publisher-name">محمد على</p>
                                                        <p class="comment-content">اخر ميعاد للتقديم امتي يابشمهندس؟</p>
                                                        <span class="comment-time">2017-08-27T23:40:12</span>
                                                        <i class="fa fa-trash comment-delet" aria-hidden="true"></i>
                                                    </form>
                                                </div>-->
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% endif %}

                                

                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane fade " id="requests">
                            
                            {% if pending_posts %}
                                {% for p_post in pending_posts %}
                                    <form method="POST" action="{% url 'api_change_post' %}" id="post-request-form{{ p_post.id }}" class="post-form">
                                        {% csrf_token %}
                                        <input type="hidden" name="post_id" value="{{ p_post.id }}" />
                                        <div class="request-view-box">
                                            <div class="request-head">
                                                <p>{{ p_post.user.username }}</p>
                                                <span>{{ p_post.last_modified }}</span>
                                            </div>
                                            <div class="request-body">
                                                <p>{{ p_post.content }}</p>
                                            </div>
                                            <div class="share-footer">
                                                <a class="nj-btn accept-a">قبول</a>
                                                <a class="nj-btn ignore-a">رفض</a>
                                            </div>
                                            <div class="accept-div">
                                                <p>هل انت متاكد من رغبتك فى قبول هذة المشاركه ؟</p>
                                                <input type="submit" name="accept_button" value="قبول" class="nj-btn" />
                                                <a class="nj-btn cancel-btn">إلغاء الامر</a>
                                            </div>
                                            <div class="ignore-div">
                                                <p>هل انت متاكد من رغبتك فى رفض هذة المشاركه ؟</p>
                                                <input type="submit" name="ignore_button" value="رفض" class="nj-btn" />
                                                <a class="nj-btn cancel-btn">إلغاء الامر</a>
                                            </div>
                                        </div>
                                    </form>
                                {% endfor %}
                            {% endif %}
                            
                            {% if pending_contributions %}
                                {% for request in pending_contributions %}
                                    <form method="POST" action="{% url 'api_change_contribution' %}" id="contribution-request-form{{ request.id }}" class="contribution-form" >
                                        {% csrf_token %}
                                        <input type="hidden" name="contribution_id" value="{{ request.id }}" />
                                        <div class="share-view-box">
                                            <div class="share-head">
                                                <p>{{ request.user.username }}</p>
                                                <span>{{ request.year }}</span>
                                            </div>
                                            <div class="share-body">
                                                <p><span>نوع المحتوى <span class="colon">:</span></span> <span>{{ content_types|dynamic_index:request.content_type }}</span></p>
                                                <p><span>عنوان المحتوى <span class="colon">:</span></span> <span>{{ request.name }}</span></p>
                                                <p><span>رقم الأسبوع <span class="colon">:</span></span> <span>{{ request.week_number }}</span></p>
                                                <p><span> رابط التحميل <span class="colon">:</span></span> <span><a href="{{ request.link }}" class="assets-link" target="_blank"><i class="fa fa-link" aria-hidden="true"></i></a></span></p>
                                            </div>
                                            <div class="share-footer">
                                                <a class="nj-btn accept-a">قبول</a>
                                                <a class="nj-btn ignore-a">رفض</a>
                                            </div>
                                            <div class="accept-div">
                                                <p>هل انت متاكد من رغبتك فى قبول هذة المشاركه ؟</p>
                                                <input type="submit" name="accept_button" value="قبول" class="nj-btn" />
                                                <a class="nj-btn cancel-btn">إلغاء الامر</a>
                                            </div>
                                            <div class="ignore-div">
                                                <p>هل انت متاكد من رغبتك فى رفض هذة المشاركه ؟</p>
                                                <input type="submit" name="ignore_button" value="رفض" class="nj-btn" />
                                                <a class="nj-btn cancel-btn">إلغاء الامر</a>
                                            </div>
                                        </div>
                                    </form>
                                {% endfor %}
                            {% endif %}
                            
                        </div><!-- end requests tab -->
                    </div>
                </div>
            </div>
            <div class="left">
                <div class="ad-block">
                    <img src="{% static 'pic/adv300x250.jpg' %}">
                </div>
            </div>
        </section>
        <!-- end page content -->

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
    <script src="http://malsup.github.com/jquery.form.js"></script>  
    <script src="{% static 'js/topic.js' %}"></script>
        
	{% endif %}
</body>
</html>
